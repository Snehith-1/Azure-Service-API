<div class="card rounded-top">
  <div class="card-title p-5 pb-6 pt-6 rounded-top bg-primary">
    <h3 class="fw-bolder text-white"><i class="fa-solid fa-hourglass-half fs-6"></i> &nbsp;&nbsp;&nbsp; Amend Quotation
    </h3>
  </div>
    <br>
    <input type="hidden" formControlName="tmpsalesorderdtl_gid">
    <!-- (ngSubmit)="onSubmit()" -->
    <form [formGroup]="QuotationForm">
      <div class="m-4 mt-4 border card">
        <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Ref. No</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text" class="form-control form-control-lg form-control-solid custom-input
                  mb-3 mb-lg-0  borderc-secondary bg-white custom-input" formControlName="Quo_referencenumber"
              class="form-control" placeholder="New Reference No" readonly style="height:40px;" />
          </div>
        </div>

        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Quotation Date</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="date"   pattern="^(?!\s*$).+" [ngStyle]="{ 'border-color': QuotationForm.get('quotation_date')?.hasError('required') && QuotationForm.get('quotation_date')?.touched ? 'red' : 'rgb(209, 209, 209)' , 'height': '42px'}"
            formControlName="quotation_date" 
       class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2" placeholder="DD-MM-YYYY"/>
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold ">Branch</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
               formControlName="branch_name" class="form-control " style="height:40px;"/>
          </div>
        </div>
      </div>
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold">Customer Name</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input" style="height: 40px;"
              formControlName="customer_name" readonly placeholder="Auto Populate">
          </div>
        </div>

        <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold required ">Customer</span>
          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <ng-select [items]="customer_list" class="
            custom
            col-lg-11 col-12
            fv-row
            mt-2  
           "bindLabel="customer_name" formControlName="customer_name"     
          (change)="OnChangeCustomer()" placeholder="Select an option" [(ngModel)]="mdlCustomerName" > </ng-select>
          </div>
        </div> -->

        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Contact Person</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
              placeholder="Enter Contact person " formControlName="customercontact_names" class="form-control" style="height:40px;"  />
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-6 col-sm-12">
          <span class="font-bold">Mobile<span class="ms-1 text-red">*</span></span>
          <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-2">
            <ngx-intl-tel-input [cssClass]="'form-control custom-width'"
            [preferredCountries]="[CountryISO.UnitedKingdom]" [enableAutoCountrySelect]="true"
            [enablePlaceholder]="true" [searchCountryFlag]="true"
            [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
            [selectedCountryISO]="CountryISO.UnitedKingdom" [phoneValidation]="true"
             name="mobiles" [maxLength]="15" formControlName="customer_mobile" style="height:40px;"></ngx-intl-tel-input>
          </div>
        </div>
        <!-- <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Contact Number</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
              placeholder="Enter Contact Number" formControlName="customer_mobile" class="form-control" style="height:40px;" />
          </div>
        </div> -->
      </div>

      <div class="d-flex flex-row m-6 flex-wrap">
      
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold  required">Email Address</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
              formControlName="customer_email" class="form-control" style="background-color: #e9e7e7" style="height:40px;" />
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold  required">Customer Address</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">

            <textarea type="text" class="
            form-control form-control-lg form-control-solid custom-input
            mb-3 mb-lg-0  borderc-secondary bg-white custom-input" formControlName="customer_address"
                       readonly  class="form-control " rows="3" ></textarea>
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"> <span class="font-bold ">Shipping Address</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            
            <textarea type="text" class="
            form-control form-control-lg form-control-solid custom-input
            mb-3 mb-lg-0  borderc-secondary bg-white custom-input" formControlName="shipping_to"
                       readonly  class="form-control " rows="3" ></textarea>
          </div>
        </div>
      </div>
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Sales Person</span>
          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">

            <ng-select formControlName="user_name" [items]="contact_list" 
              class="custom col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2" bindLabel="user_name"
              bindValue="user_gid" placeholder="Select an option" [(ngModel)]="mdlUserName">
            </ng-select>
          </div>
        </div>
 <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold ">Customer Ref. No</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
              placeholder="Customer Ref.No" formControlName="quotation_gid" class="form-control" style="height:40px;" />
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold ">Remarks</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            
            <textarea type="text" class="
            form-control form-control-lg form-control-solid custom-input
            mb-3 mb-lg-0  borderc-secondary bg-white custom-input" formControlName="so_remarks"
                       readonly  class="form-control " rows="3" ></textarea>
          </div>
        </div>
      </div>

      <div class="d-flex flex-row m-6 flex-wrap">

        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Freight Terms</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0  borderc-secondary bg-white custom-input"
              placeholder="Freight terms" formControlName="freight_terms" class="form-control" style="height: 40px;" />
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Payment Terms</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0  borderc-secondary bg-white custom-input"
              placeholder="Payment Terms" formControlName="payment_terms" class="form-control" style="height: 40px;"/>
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold required">Currency</span>
          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">

            <ng-select formControlName="currency_code" [items]="currency_list" 
              class="custom col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2" bindLabel="currency_code"
              bindValue="currencyexchange_gid" placeholder="Select an option" [(ngModel)]="mdlCurrencyName">
              <option *ngFor="let currency of currency_list" [value]="currency.currencyexchange_gid">
                {{currency.currency_code}}</option>
            </ng-select>
          </div>
        </div>
      </div>
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-3 col-sm-12"><span class="font-bold ">Exchane Rate</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0  borderc-secondary bg-white custom-input"
              readonly placeholder="Exchange Rate" formControlName="exchange_rate" class="form-control bg-secondary"  style="height: 40px;"/>
          </div>
        </div>
      </div>
      </div>
 
      <div class="card-header bg-lightblue card-height55" style="border-radius: 0px;">
        <div class="card-title m-0">
          <h3 class="fw-bolder text-blue">Product Summary</h3>
        </div>
      </div>

      <form [formGroup]="productform">
        <div class="d-flex flex-row flex-wrap m-6">
          <div class="col-12 col-lg-2 col-md-2 col-sm-12"><span class="font-bold required">Product</span>
              <ng-select [items]="product_list" class="custom col-lg-11 col-12 fv-row mt-2" bindLabel="product_name" (change)="GetOnChangeProductsName()" formControlName="product_name" placeholder="Select an option" [(ngModel)]="mdlproductName"></ng-select>
            <!-- </div> -->
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Product Code</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control bg-secondary" formControlName="product_code" readonly  style="height: 40px;">
            </div>
          </div>


          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Unit</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control" style="text-align: right; height: 40px;" formControlName="productuom_name">
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Unit Price</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control" placeholder="0.00" style="text-align: right; height: 40px;" formControlName="unitprice" [(ngModel)]="unitprice" (input)="prodtotalcal()">
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Quantity</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control" style="text-align: right; height: 40px;" formControlName="quantity" [(ngModel)]="quantity" (input)="prodtotalcal()">
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Discount(%)</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control mt-2 bg-secondary" placeholder="0.00" style="text-align: right; height: 40px;" formControlName="discountpercentage" [(ngModel)]="discountpercentage" (input)="prodtotalcal()">
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold">Amount</span>
            <div class="col-lg-9 col-12 col-md-11 col-sm-11 fv-row mt-2 ms-1">
              <input type="text" class="form-control" placeholder="0.00" style="text-align: right; height: 40px;" formControlName="discountamount" [(ngModel)]="discountamount" (input)="prodtotalcal()">            
            </div>
          </div>
          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold required">Tax</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <ng-select [items]="tax_list" class="
                        custom
                col-lg-10 col-12
                fv-row
                mt-2
              " bindLabel="tax_name" formControlName="tax_name" bindValue="tax_gid" (change)="taxAmount()"
                placeholder="Select Tax" [(ngModel)]="mdlTaxName1"></ng-select>
            </div>
          </div>


          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold">Tax Amount</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control mt-2 bg-secondary" placeholder="0.00" style="text-align: right; height: 40px;" formControlName="tax_amount" [(ngModel)]="tax_amount">
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12"><span class="font-bold">Total Amount</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class="form-control bg-secondary"  placeholder="0.00" style="text-align: right; height: 40px; width: 120px;" formControlName="totalamount" [(ngModel)]="totalamount" (input)="prodtotalcal()" >
            </div>
          </div>

          <div class="col-12 col-lg-1 col-md-1 col-sm-12 "><span class="font-bold text-center ms-19">Action</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2 ms-19">
              <button title="submit" class=" btn btn-icon btn-sm bg-success me-1" (click)="onadd()">+</button>&nbsp;
                <button title="Update" type="button" (click)="onadd()"
                  class="btn btn-icon btn-sm bg-primary me-1"><span
                    class="fa-solid fa-arrow-up text-white  fs-6"></span></button>
            </div>
          </div>
        </div>

        <!-- end::Product Form -->
        <!-- begin::table -->
        <div class="table-responsive">
          <div class="card card-body table-responsive m-0 p-3 mb-5 bg-white rounded">
            <table id="salesorders_list" class="table table-striped table-row-bordered gy-4 gs-2">
              <thead class="table_head">
                <tr class="text-white fw-bold fs-5 text-nowrap bg-lightblue text-blue">
                  <th>S.No</th>
                  <th>Product </th>
                  <th>Product Group</th>
                  <th>Product Code</th>
                  <th>Unit</th>
                  <th style="text-align: right;">Unit Price</th>
                  <th style="text-align: right;">MRP</th>
                  <th style="text-align: right;">Quantity</th>
                  <th style="text-align: right;">Discount (%)</th>
                  <th style="text-align: right;">Tax</th>
                  <th style="text-align: right;">Total Amount</th>
                  <th class="text-center">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of quotationproductlist; let i=index;">
                    <td>{{i+1}}</td>
                    <td>{{data.product_name}}</td>
                    <td>{{data.productgroup_name}}</td>
                    <td>{{data.product_code}}</td>
                    <td>{{data.uom_name}}</td>
                    <td style="text-align: right;">{{data.product_price}}</td>
                    <td style="text-align: right;">{{data.mrp}}</td>
                    <td style="text-align: right;">{{data.qty_quoted}}</td>
                    <td style="text-align: right;">{{data.discount_percentage -- data.discount }}</td>
                    <td style="text-align: right;">{{data.tax}}</td> 
                    <td style="text-align: right;">{{data.product_total}}</td> 
                    
                    <td class="text-center text-nowrap">
                      <button title="Edit" type="button" class="btn btn-icon btn-sm bg-etdark me-2"
                        data-bs-toggle="modal" data-bs-target="#myModaledit">
                        <i class="fa-solid fa-pencil text-white  fs-2" aria-hidden="true"></i>
                      </button>

                      <button title="Delete" type="button" class="btn btn-icon btn-sm bg-danger me-1"
                        data-bs-toggle="modal" data-bs-target="#myModaldelete">
                        <i class="fa fa-trash fs-4" aria-hidden="true"></i>
                      </button>
                    </td>         
                  </tr>
              </tbody>
            </table>
          </div>
          <div class="modal" id="myModaldeleteSO" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog del_modal-dialog">
              <div class="modal-content del_modal-content">
                <div class="text-center my-4">
                  <h2><b>Are you sure?</b></h2>
                  <p style="display: block;">Do You Want To Delete the Record ?</p>
                  <div class="text-center my-4">
                    <button class="btn-danger btn-sm text-white me-4" data-bs-dismiss="modal">
                      <i class="bi bi-trash-fill text-white fs-5 me-2"></i>Delete
                    </button>
                    <button class="btn-primary btn-sm text-white me-2" data-bs-dismiss="modal">
                      <i class="fas fa-close text-white me-2"></i>Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="card">

        <div class="d-flex flex-row m-6 flex-wrap">
          <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold required">Payment Days</span>
            <div class="col-lg-8 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0  borderc-secondary bg-white custom-input"
                formControlName="payment_days" class="form-control" placeholder="Payment Days" style="width:120px; ;height:40px;" />

            </div>
          </div>

          <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold required">Delivery Days</span>
            <div class="col-lg-8 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" placeholder="Delivery Days"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0  borderc-secondary bg-white custom-input"
                formControlName="delivery_days" class="form-control" style="width:120px; ;height:40px;" />
            </div>
          </div>
        </div>

        <div class="card p-7">
          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Net Amount:</label>
              <input type="text" class="form-control bg-secondary" formControlName="producttotalamount"
                [(ngModel)]="producttotalamount" style="width:120px; ;height:40px;"
                readonly>
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Addon Charges:</label>
              <input type="text" formControlName="addon_charge" class="form-control" style="width:120px; ;height:40px;"
                placeholder="0.00" [(ngModel)]="addon_charge">
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Additional Discount:</label>
              <input type="text" formControlName="additional_discount" class="form-control" style="width:120px; ;height:40px;"
                placeholder="0.00" [(ngModel)]="additional_discount">
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Freight Charges:</label>
              <input type="text" formControlName="freight_charges" class="form-control" style="width:120px; ;height:40px;"
                placeholder="0.00" [(ngModel)]="freight_charges">
            </div>
          </div>
          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Buy Back/Scrap:</label>
              <input type="text" formControlName="buyback_charges" class="form-control" style="width:120px; ;height:40px;"
                placeholder="0.00" [(ngModel)]="buyback_charges">
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Packing/Forwarding Charges:</label>
              <input type="text" class="form-control" style="width:120px; ;height:40px;" formControlName="packing_charges"
                placeholder="0.00">&nbsp;
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Insurance Charges:</label>
              <input type="text" formControlName="insurance_charges" class="form-control" style="width:120px; ;height:40px;"
                placeholder="0.00" [(ngModel)]="insurance_charges">
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Round Off:</label>
              <input type="text" formControlName="roundoff" class="form-control" style="width:120px; ;height:40px;" placeholder="0.00"
                [(ngModel)]="roundoff">
            </div>
          </div>

          <div class="d-flex row justify-content-end mt-2 mb-3">
            <div class="col-md-3 d-flex align-items-center">
              <label class="col-sm-6 col-form-label font-bold">Grand Total:</label>
              <input type="text" formControlName="grandtotal" readonly class="form-control bg-secondary"
              style="width:120px; ;height:40px;" placeholder="0.00"
                [(ngModel)]="grandtotal">
            </div>
          </div>


          <!--Summary count ends-->

          <div class="card-header bg-lightblue card-height55">
            <div class="card-title m-0">
              <h5 class="fw-bolder text-blue">Terms and Conditions</h5>
            </div>
          </div>
          <ng-select [items]="terms_list" class="custom col-lg-4 m-6 col-12 fv-row mt-5" bindLabel="template_name"
          [(ngModel)]="mdlTerms" formControlName="template_name" bindValue="template_gid"
          placeholder="Select an option" (change)="GetOnChangeTerms()"></ng-select>
        <div class="d-flex flex-row m-2 col-lg-12 table-responsive">
          <div class="col-12 col-lg-12 col-md-10  col-sm-10 fv-row mt-2">
            <angular-editor [config]="config" formControlName="termsandconditions"></angular-editor>
          </div>
        </div>


          <div class="text-center my-4">
            <button type="submit" class="btn-success btn-sm text-white me-4" data-bs-dismiss="modal">
              <i class="fas fa-check text-white fs-5 "></i> &nbsp;Submit
            </button> &nbsp;&nbsp;
            <button class="btn-primary btn-sm text-white me-4" routerLink="/smr/SmrTrnQuotationSummary" data-bs-dismiss="modal">
              <i class="fas fa-arrow-left text-white" > </i> &nbsp;Back 
            </button>
          </div>
        </div>
      </div>
    </form>
  
</div>