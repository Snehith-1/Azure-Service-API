<div class="card m-3">
    <div class="card-header bg-lightblue card-height55">
        <div class="card-title m-0 ">
            <h5 class="fw-bolder text-blue">Add GRN</h5>
        </div>
    </div>

    <form [formGroup]="addgrnform">        
        <div class="d-flex flex-row m-6 flex-wrap">
            <div class="col-12 col-lg-4 col-md-4 col-sm-12">
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row">
                    <div class="d-flex flex-row flex-wrap">
                        <div class="col-12 col-lg-7 col-md-7 col-sm-12"><b>GRN Ref No</b>
                            <div class="col-lg-11 col-12 col-md-11 col-sm-12 fv-row mt-2">
                                <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary custom-input" formControlName="grn_gid" placeholder="GRN Ref No" />
                            </div>
                        </div>
                        <div class="col-12 col-lg-5 col-md-5 col-sm-12"><b>GRN Date</b>
                            <div class="mt-2">
                                <input type="date" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" formControlName="grn_date" placeholder="GRN Date"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>Branch Name</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" formControlName="branch_name" placeholder="Auto Populate" readonly/>
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>Vendor Name</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" formControlName="vendor_companyname" readonly/>
                </div>
            </div>
        </div>

        <div class="d-flex flex-row m-6 flex-wrap">
            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>Vendor Contact Person</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="type" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" formControlName="contactperson_name"/>
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12">
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row">
                    <div class="d-flex flex-row flex-wrap">
                        <div class="col-12 col-lg-5 col-md-5 col-sm-12"><b>Contact Number</b>
                            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" placeholder="Contact Number" formControlName="contact_telephonenumber" readonly/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-7 col-md-7 col-sm-12"><b>Email Address</b>
                            <div class="mt-2">
                                <input type="type" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" formControlName="email_id" readonly/>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
            
            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>Contact Address</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <textarea type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" rows="1" formControlName="address" readonly></textarea>
                </div>
            </div>
        </div>


        <div class="d-flex flex-row m-6 flex-wrap">
            <div class="col-12 col-lg-4 col-md-4 col-sm-12">
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row">
                    <div class="d-flex flex-row flex-wrap">
                        <div class="col-12 col-lg-11 col-md-11 col-sm-12"><b>PO Reference No</b>
                            <div class="mt-2">
                                <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" formControlName="purchaseorder_gid" readonly/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-1 col-md-1 col-sm-12">
                            <div class="mt-12">
                                <i class="fas fa-question-circle text-primary fs-1 ms-4" (click)="GetPurchaseOrderDetails()" data-bs-toggle="modal" data-bs-target="#myModalrefno"></i>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>Raised By</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-secondary custom-input" formControlName="user_firstname" readonly/>
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12"><b>GRN Remarks</b>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <textarea type="text" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" rows="1" formControlName="grn_remarks" placeholder="GRN Ref"></textarea>
                </div>
            </div>
        </div>

        <div class="d-flex flex-row m-6 flex-wrap">
            <div class="col-12 col-lg-4 col-md-4 col-sm-12">
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row">
                    <div class="d-flex flex-row flex-wrap">
                        <div class="col-12 col-lg-7 col-md-7 col-sm-12"><b>Delivery Order Number<span class="ms-1 text-red">*</span></b>
                            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                <input type="text" formControlName="dc_no" class="form-control form-control-lg form-control-solid custom-input bg-white custom-input" placeholder="DO Number" [ngStyle]="{'border-color': dc_noControl.invalid && dc_noControl.touched ? 'red' : 'rgb(209, 209, 209)'}" pattern="^(?!\s*$).+" [class.is-invalid]="dc_noControl.invalid && (dc_noControl.dirty || dc_noControl.touched)"/>
                                <div *ngIf="dc_noControl.invalid && (dc_noControl.dirty || dc_noControl.touched)" class="invalid-feedback">
                                    <div *ngIf="dc_noControl.errors?.['required']">
                                      <span style="color: red; width: 200px; margin-top: 1px; margin-left: 8px; font-size: 11px;">* Delivery order number is required</span>
                                    </div>
                                  </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-5 col-md-5 col-sm-12"><b>DC Date</b>
                            <div class="mt-2">
                                <input type="date" formControlName="dc_date" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" placeholder="DC Date"/>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>

            <div class="col-12 col-lg-4 col-md-4 col-sm-12">
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row">
                    <div class="d-flex flex-row flex-wrap">
                        <div class="col-12 col-lg-7 col-md-7 col-sm-12"><b>Invoice Reference Number</b>
                            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                <input type="text" formControlName="invoiceref_no" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" placeholder="Invoice Ref No"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-5 col-md-5 col-sm-12"><b>Invoice Date</b>
                            <div class="mt-2">
                                <input type="date" formControlName="invoice_date" class="form-control form-control-lg form-control-solid custom-input border-secondary bg-white custom-input" placeholder="Product Code"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            

            <div class="col-12 col-lg-4 col-md-6 col-sm-12"><b>Priority</b>
                <div class="d-flex justify-content-start ms-2">
                    <div class="form-check form-check-custom form-check-success form-check-solid form-check-sm mt-7">
                        <input class="form-check-input" type="radio" name="priority" formControlName ="priority_flag" id="N" value="N">
                        <label class="form-check-label text-gray-700 text-nowrap"
                            for="kt_builder_header_content_menu">Low</label>
                    </div>
                    <div class="form-check form-check-custom form-check-success form-check-solid form-check-sm ms-10 mt-7">
                        <input class="form-check-input" type="radio" name="priority" formControlName ="priority_flag" id="Y" value="Y">
                        <label class="form-check-label text-gray-700 text-nowrap"
                            for="kt_builder_header_content_page-title">High</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-responsive mt-20">
            <table  class="table table-striped table-row-bordered gy-5 gs-7">
                <thead>
                    <tr class="fw-bold fs-5 bg-lightblue text-blue align-middle">
                        <th>
                            <input type="checkbox" id="checkAll" (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()" />                            
                        </th>                        
                        <th>Product Group</th>
                        <th>Product</th>
                        <th>Units</th>
                        <th style="text-align: center;">Qty Ordered</th>
                        <th style="text-align: center;">Qty Received</th>
                        <th style="text-align: right;">Qty Received As Per Invoice</th>
                        <th style="text-align: center;">Qty Adjusted</th>
                        <th style="text-align: right;">Qty Delivered</th>
                        <th style="text-align: right;">Qty Adjustable</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let data of addgrn_lists; let i=index;" class="align-middle">
                        <td>
                            <input type="checkbox" (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(data) : null" [checked]="selection.isSelected(data)"/>
                        </td>                       
                        <td>{{data.productgroup_name}}</td>
                        <td>{{data.product_name}}</td>
                        <td>{{data.productuom_name}}</td>
                        <td style="text-align: center;">{{data.qty_ordered}}</td>
                        <td style="text-align: center;">{{data.qty_received}}</td>
                        <td style="text-align: right;">
                            <input type="text" formControlName="qtyreceivedas_{{i}}" [(ngModel)]="data.qtyreceivedas" (ngModelChange)="event(data,i)"/>                            
                        </td>
                        <td style="text-align: center;">{{data.qty_grnadjusted}}</td>
                        <td style="text-align: right;">
                            <input type="text" formControlName="qty_delivered_{{i}}" placeholder="0.00" [(ngModel)]="data.qty_delivered" style="text-align: right;"/>
                        </td>
                        <td style="text-align: right;">
                            <input type="number"   formControlName="qty_grnadjusted_{{i}}" style="text-align: right;"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="text-center my-4">
            <button class="btn-sm text-white me-2" [ngClass]="{'primary-button': !addgrnform.invalid, 'secondary-button': addgrnform.invalid }" (click)="onsubmit()">
                <i class="fas fa-check text-white fs-5"></i> &nbsp; Submit
            </button> &nbsp;&nbsp;
            <button class="btn-danger btn-sm text-white me-4" (click)="onclose()" routerLink="/pmr/PmrTrnGrninwardadd" data-bs-dismiss="modal">
                <i class="fas fa-close text-white"></i> &nbsp;Back
            </button>
        </div>
    </form>
</div>



<div class="modal" id="myModalrefno" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="card-header p-1 pb-3 pt-2 rounded-top bg-primary">
                <div>
                    <h2 class="fw-bolder ms-5 mt-4" style="color: #ffffff;">Purchase Order Details
                        <i class="fas fa-close text-white fs-2 float-end me-6" data-bs-dismiss="modal"></i>
                    </h2>
                    
                </div>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <div class="table-responsive">
                    <div class="bg-white rounded">
                        <table class="table table-striped table-row-bordered gy-5 gs-7">
                            <thead>
                                <tr class="fw-bold fs-8 bg-lightblue text-blue" style="text-align: bottom;">
                                    <!-- <th>S.No</th> -->
                                    <th>Product Group</th>
                                    <th>Product Code</th>
                                    <th>Product Name</th>
                                    <th>Units</th>
                                    <th style="text-align: center;">Qty Ordered</th>
                                    <th style="text-align: right;">Unit Price</th>
                                    <th style="text-align: right;">Disc. %</th>
                                    <th style="text-align: right;">Disc. (Rs)</th>
                                    <th style="text-align: right;">Tax</th>
                                    <th style="text-align: right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="align-middle fs-8" *ngFor="let data of purchaseorder_list; let i=index;">
                                    <!-- <td>{{i+1}}</td> -->
                                    <td>{{data.productgroup_name}}</td>
                                    <td>{{data.product_code}}</td>
                                    <td>{{data.product_name}}</td>
                                    <td>{{data.productuom_name}}</td>
                                    <td style="text-align: center;">{{data.qty_ordered}}</td>
                                    <td style="text-align: right;">{{data.product_price}}</td>
                                    <td style="text-align: right;">{{data.discount_percentage}}</td>
                                    <td style="text-align: right;">{{data.discount_amount}}</td>
                                    <td style="text-align: right;">{{data.tax}}</td>
                                    <td class="fw-bold" style="text-align: right;">{{data.product_total}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>                
            </div>

            <div class="d-flex flex-row flex-wrap justify-content-end">
                <label class="fw-bold" style="width: 90px; text-align: right;">Payment:</label>
                <span class="fw-bold ms-4">{{this.payment_days}}</span>
                <span class="fw-bold ms-2 me-4">Days</span>
            </div>

            <div class="d-flex flex-row flex-wrap justify-content-end">
                <label class="fw-bold" style="width: 90px; text-align: right;">Delivery:</label>
                <span class="fw-bold ms-4">{{this.delivery_days}}</span>
                <span class="fw-bold ms-2 me-4">Days</span>
            </div>

            <div class="d-flex flex-row flex-wrap justify-content-end mt-10">
                <label class="fw-bold" style="width: 90px; text-align: right;">Total:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.total_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Tax:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.total_tax}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Addon Discount:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.discount_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Addon Amount:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.addon_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">            
                <label class="fw-bold" style="width: 90px; text-align: right;">Freight Charges:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.freight_charges}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>            
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Buy Back/Scrap:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.buybackorscrap}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2 mb-10">
                <label class="fw-bold" style="width: 90px; text-align: right;">Grand Total:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.grand_total}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
        </div>
    </div>
</div>