<form [formGroup]="addgrnform" novalidate="novalidate">
    <div class="card rounded-top">
        <div class="card-title p-5 pb-6 pt-6 rounded-top bg-primary"  style="height:50px;">
            <h3 class="fw-bolder text-white"><i class="fas fa-plus fw-bolder fs-3"></i> &nbsp;&nbsp;&nbsp;Add GRN
            </h3>
        </div>


        <div class="d-flex flex-row m-6  flex-wrap row">
            <div class="col-lg-4 col-md-12 col-sm-12 ">
                <span class="font-bold">GRN Ref No</span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="grn_gid" 
                        class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-white custom-input mt-2" />
                </div>
            </div>
                    
            <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold mt-2">GRN Date</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-1 ">
                        <input type="date"   pattern="^(?!\s*$).+" [ngStyle]="{ 'border-color': addgrnform.get('grn_date')?.hasError('required')
                     && addgrnform.get('grn_date')?.touched ? 'red' : 'rgb(209, 209, 209)' , 'height': '42px'}"
                    formControlName="grn_date"
                    class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2" placeholder="DD-MM-YYYY"/>
                </div>        
             </div>
            
            <div class="col-lg-4 col-md-12 col-sm-12 ">
                <span class="font-bold">Branch Name</span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="branch_name" 
                        class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-white  bg-secondary custom-input mt-2" />
                </div>
            </div>
        </div>
        <div class="d-flex flex-row m-6  flex-wrap row">
            
            <div class="col-lg-4 col-md-12 col-sm-12">
                <span class="font-bold">PO Ref. No</span>
                <div class="col-lg-10 col-12 col-md-11 col-sm-11 fv-row" style="display: flex; flex-direction: column;" >                 
                    <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"  formControlName="purchaseorder_gid" 
                        class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0   bg-white custom-input mt-2" />                                             
                        <span style="margin-left: 310px; margin-top: -26px; font-weight: bold;"><i class="fas fa-question-circle text-primary fs-1 ms-4" (click)="GetPurchaseOrderDetails()" data-bs-toggle="modal" data-bs-target="#myModalrefno"></i></span>  
                        </div>
                        </div>  
            <div class="col-lg-4 col-md-12 col-sm-12 ">
                <span class="font-bold">Vendor Name</span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="vendor_companyname" 
                        class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-white  bg-secondary custom-input mt-2" />
                </div>
            </div>
            <div class="col-lg-4 col-md-12 col-sm-12 ">
                <span class="font-bold">Vendor Contact Person</span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="contactperson_name" 
                        class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-secondary custom-input mt-2" />
                </div>
            </div>
           
            </div>

            <div class="d-flex flex-row m-6  flex-wrap row">
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold">Contact Number</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                        <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="contact_telephonenumber" 
                            class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0   bg-secondary custom-input mt-2" />
                    </div>
                </div>
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold">Email Address</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                        <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="email_id" 
                            class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0   bg-secondary custom-input mt-2" />
                    </div>
                </div>

                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold">Contact Address</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                        
                            <textarea type="text"  [ngStyle]="{ 'border-color': addgrnform.get('address')?.hasError('required') && addgrnform.get('address')?.touched ? 'red' : 'rgb(209, 209, 209)' }"
                            pattern="^(?!\s*$).+"  formControlName="address" 
                            class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white custom-input mt-2" rows="3"
                            ></textarea>
                    </div>
                </div>

            </div>
            <div class="d-flex flex-row m-6  flex-wrap row">
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold">Raised By</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                        <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="user_firstname" 
                            class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0   bg-secondary custom-input mt-2" />
                    </div>
                </div>
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold">Invoice Reference Number<span class="ms-1 text-red">*</span></span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                      
                            <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="invoiceref_no" 
                            class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-white custom-input mt-2" />
                        </div>
                </div>
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                    <span class="font-bold mt-2">Invoice Date</span>
                    <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-1 ">
                        <input type="date"   pattern="^(?!\s*$).+" [ngStyle]="{ 'height': '42px'}"
                    formControlName="invoice_date"
                    class="form-control form-control-lg form-control-solid date-picker borderc-secondary custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2" placeholder="DD-MM-YYYY"/>
                </div>           
             </div>  
               
               
                </div>

                <div class="d-flex flex-row m-6  flex-wrap row">
                 

                    <div class="col-lg-4 col-md-12 col-sm-12 ">
                        <span class="font-bold">Delivery Order Number<span class="ms-1 text-red">*</span></span>
                        <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                            <input type="text"  [ngStyle]="{ 'border-color': 'rgb(209, 209, 209)','height': '42px'}"   formControlName="dc_no" 
                                class="form-control form-control-lg form-control-solid inputfield custom-input mb-3 mb-lg-0 bg-white custom-input mt-2" />
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-12 col-sm-12 ">
                        <span class="font-bold mt-2">DC Date</span>
                        <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-1 ">
                            <input type="date"   pattern="^(?!\s*$).+" [ngStyle]="{ 'height': '42px'}"
                        formControlName="dc_date"
                        class="form-control form-control-lg form-control-solid date-picker borderc-secondary custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2" placeholder="DD-MM-YYYY"/>
                    </div>           
                 </div>    
           
            <div class="col-lg-4 col-md-12 col-sm-12 "><b>Priority</b>
                <div class="d-flex justify-content-start ms-2">
                    <div class="form-check form-check-custom form-check-success form-check-solid form-check-sm mt-7">
                        <input class="form-check-input" type="radio" name="priority" formControlName ="priority_flag" id="N" value="N">
                        <label class="form-check-label text-gray-700 text-nowrap"
                            for="kt_builder_header_content_menu">Low</label>
                    </div>
                    <div class="form-check form-check-custom form-check-success form-check-solid form-check-sm ms-10 mt-7">
                        <input class="form-check-input" type="radio" name="priority" formControlName ="priority_flag" id="Y" value="Y">
                        <label class="form-check-label text-gray-700 text-nowrap"
                            for="kt_builder_header_content_page-title">High</label>
                    </div>
                </div>
                </div>
             </div>
             <div class="d-flex flex-row m-6  flex-wrap row">
                <div class="col-lg-4 col-md-12 col-sm-12 ">
                <span class="font-bold">GRN Remarks</span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                        <textarea type="text"  [ngStyle]="{ 'border-color': addgrnform.get('grn_remarks')?.hasError('required') && addgrnform.get('grn_remarks')?.touched ? 'red' : 'rgb(209, 209, 209)' }"
                        pattern="^(?!\s*$).+"  formControlName="grn_remarks" 
                        class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white custom-input mt-2" rows="3"
                        ></textarea>
                </div>
            </div>
            </div>
            <div class="table-responsive mt-20">
                <table  class="table table-striped table-row-bordered gy-5 gs-7">
                    <thead>
                        <tr class="fw-bold fs-5 bg-lightblue text-blue align-middle">
                            <th>
                                <input type="checkbox" id="checkAll" (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()" />
                            </th>                        
                            <th>Product Group</th>
                            <th>Product</th>
                            <th>Units</th>
                            <th style="text-align: center;">Qty Ordered</th>
                            <th style="text-align: center;">Qty Received</th>
                            <th style="text-align: center;">Qty Received As <br>Per Invoice</th>
                            <th style="text-align: center;">Qty Adjusted</th>
                            <th style="text-align: center;">Qty Delivered</th>
                            <th style="text-align: center;">Qty Adjustable</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of addgrn_lists; let i=index;" class="align-middle">
                            <td>
                                <input type="checkbox" (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(data) : null" [checked]="selection.isSelected(data)"/>
                            </td>                       
                            <td>{{data.productgroup_name}}</td>
                            <td>{{data.product_name}}</td>
                            <td>{{data.productuom_name}}</td>
                            <td style="text-align: center;">{{data.qty_ordered}}</td>
                            <!-- <td style="text-align: center;">{{data.qty_received}}</td> -->
                            <td style="text-align: right;">
                                <input type="text" formControlName="qty_received_{{i}}" placeholder="0.00" [(ngModel)]="data.qty_received" style="text-align: right;" readonly/>
                            </td>
                            <td style="text-align: right;">
                                <input type="text" formControlName="qtyreceivedas_{{i}}" [(ngModel)]="data.qtyreceivedas" (ngModelChange)="event(data,i)"/>                            
                            </td>
                            <td style="text-align: center;">{{data.qty_grnadjusted}}</td>
                            <td style="text-align: right;">
                                <input type="text" formControlName="qty_delivered_{{i}}" placeholder="0.00" [(ngModel)]="data.qty_delivered" style="text-align: right;"/>
                            </td>
                            <td style="text-align: right;">
                                <input type="number"   formControlName="qty_grnadjusted_{{i}}" style="text-align: right;"/>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="text-center my-4">
                <button class="btn-sm text-white me-2" [ngClass]="{'primary-button': !addgrnform.invalid, 'secondary-button': addgrnform.invalid }" (click)="onsubmit()">
                    <i class="fas fa-check text-white fs-5"></i> &nbsp; Submit
                </button> &nbsp;&nbsp;
                <button class="btn-danger btn-sm text-white me-4"  routerLink="/pmr/PmrTrnGrninwardadd" data-bs-dismiss="modal">
                    <i class="fas fa-close text-white"></i> &nbsp;Back
                </button>
            </div>
       
    
        </div>
</form>

<div class="modal" id="myModalrefno" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="card-header p-1 pb-3 pt-2 rounded-top bg-primary">
                <div>
                    <h2 class="fw-bolder ms-5 mt-4" style="color: #ffffff;">Purchase Order Details
                        <i class="fas fa-close text-white fs-2 float-end me-6" data-bs-dismiss="modal"></i>
                    </h2>
                    
                </div>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <div class="table-responsive">
                    <div class="bg-white rounded">
                        <table class="table table-striped table-row-bordered gy-5 gs-7">
                            <thead>
                                <tr class="fw-bold fs-8 bg-lightblue text-blue" style="text-align: bottom;">
                                    <!-- <th>S.No</th> -->
                                    <th>Product Group</th>
                                    <th>Product Code</th>
                                    <th>Product Name</th>
                                    <th>Units</th>
                                    <th style="text-align: center;">Qty Ordered</th>
                                    <th style="text-align: right;">Unit Price</th>
                                    <th style="text-align: right;">Disc. %</th>
                                    <th style="text-align: right;">Disc. (Rs)</th>
                                    <th style="text-align: right;">Tax</th>
                                    <th style="text-align: right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="align-middle fs-8" *ngFor="let data of purchaseorder_list; let i=index;">
                                    <!-- <td>{{i+1}}</td> -->
                                    <td>{{data.productgroup_name}}</td>
                                    <td>{{data.product_code}}</td>
                                    <td>{{data.product_name}}</td>
                                    <td>{{data.productuom_name}}</td>
                                    <td style="text-align: center;">{{data.qty_ordered}}</td>
                                    <td style="text-align: right;">{{data.product_price}}</td>
                                    <td style="text-align: right;">{{data.discount_percentage}}</td>
                                    <td style="text-align: right;">{{data.discount_amount}}</td>
                                    <td style="text-align: right;">{{data.tax}}</td>
                                    <td class="fw-bold" style="text-align: right;">{{data.product_total}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>                
            </div>


            <div class="d-flex flex-row flex-wrap justify-content-end">
                <label class="fw-bold" style="width: 90px; text-align: right;">Payment:</label>
                <span class="fw-bold ms-4">{{this.payment_days}}</span>
                <span class="fw-bold ms-2 me-4">Days</span>
            </div>

            <div class="d-flex flex-row flex-wrap justify-content-end">
                <label class="fw-bold" style="width: 90px; text-align: right;">Delivery:</label>
                <span class="fw-bold ms-4">{{this.delivery_days}}</span>
                <span class="fw-bold ms-2 me-4">Days</span>
            </div>

            <div class="d-flex flex-row flex-wrap justify-content-end mt-10">
                <label class="fw-bold" style="width: 90px; text-align: right;">Total:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.total_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Tax:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.total_tax}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Addon Discount:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.discount_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Addon Amount:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.addon_amount}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">            
                <label class="fw-bold" style="width: 90px; text-align: right;">Freight Charges:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.freight_charges}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>            
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2">
                <label class="fw-bold" style="width: 90px; text-align: right;">Buy Back/Scrap:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.buybackorscrap}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
            
            <div class="d-flex flex-row flex-wrap justify-content-end mt-2 mb-10">
                <label class="fw-bold" style="width: 90px; text-align: right;">Grand Total:</label>
                <span class="fw-bold ms-4" style="width: 50px; text-align: right;">{{this.grand_total}}</span>
                <span class="fw-bold ms-2 me-4">{{this.currency_code}}</span>
            </div>
        </div>
    </div>
</div>